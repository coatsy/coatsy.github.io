<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>Counting the number of sections in an OpenXML Document</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/Andrew Coates [MSFT]' target='_blank'>Andrew Coates [MSFT]</a>
<time>    3/31/2011 8:54:00 PM</time>
<hr>
<div id='content'><p><small><font color="#ff0000">1/4/11 - Updated a couple of images and some of the code explanation</font></small></p>  <p>Adam Cogan asked me a question the other day that asked (among other things) &quot;How do you know if a doc has multiple sections?&quot;</p>  <p>In Word, of course, you can break a document up into sections by inserting a section&#160; break from the Breaks button in the Page Setup group on the Page Layout tab:</p>  <p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Inserting section breaks manually in Word is easy" border="0" alt="Inserting section breaks manually in Word is easy" src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/39/01/metablogapi/2275.image_77B7C259.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-01-metablogapi/2275.image_5F00_77B7C259.png" width="521" height="526" /></p>  <p>It turns out that counting these programmatically is really easy using the <a href="http://msdn.microsoft.com/en-us/library/bb448854(office.14).aspx">OpenXML SDK 2.0</a> (<a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=c6e744e5-36e9-45f5-8d8c-331df206e0d0&amp;DisplayLang=en">download</a>)</p>  <p>I created a new console application, added a reference to <font face="Consolas">DocumentFormat.OpenXML</font> and <font face="Consolas">WindowsBase</font> and used this code:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:633ce97f-f58d-4af3-b654-a84fe5e02cb5" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #000080; color: #fff; font-family: Verdana, Tahoma, Arial, sans-serif; font-weight: bold; padding: 2px 5px">Count Sections in Word Docx</div> <div style="background: #ddd; overflow: auto"> <ol style="background: #ffffff; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="color:#0000ff">using</span> System;</li> <li style="background: #f3f3f3"><span style="color:#0000ff">using</span> System.Collections.Generic;</li> <li><span style="color:#0000ff">using</span> System.Linq;</li> <li style="background: #f3f3f3"><span style="color:#0000ff">using</span> System.Text;</li> <li><span style="color:#0000ff">using</span> System.IO.Packaging;</li> <li style="background: #f3f3f3"><span style="color:#0000ff">using</span> DocumentFormat.OpenXml.Wordprocessing;</li> <li><span style="color:#0000ff">using</span> DocumentFormat.OpenXml.Packaging;</li> <li style="background: #f3f3f3"><span style="color:#0000ff">using</span> DocumentFormat.OpenXml.Office2010.Word;</li> <li>&nbsp;</li> <li style="background: #f3f3f3"><span style="color:#0000ff">namespace</span> CountSections</li> <li>{</li> <li style="background: #f3f3f3">  <span style="color:#0000ff">class</span> <span style="color:#2b91af">Program</span></li> <li>  {</li> <li style="background: #f3f3f3">    <span style="color:#0000ff">static</span> <span style="color:#0000ff">void</span> Main(<span style="color:#0000ff">string</span>[] args)</li> <li>    {</li> <li style="background: #f3f3f3">      <span style="color:#0000ff">if</span> (args.Length != 1)</li> <li>      {</li> <li style="background: #f3f3f3">        <span style="color:#2b91af">Console</span>.WriteLine(<span style="color:#a31515">&quot;Usage: CountSections &lt;filename&gt;&quot;</span>);</li> <li>      }</li> <li style="background: #f3f3f3">      <span style="color:#0000ff">else</span></li> <li>      {</li> <li style="background: #f3f3f3">        <span style="color:#0000ff">using</span> (<span style="color:#2b91af">WordprocessingDocument</span> d =</li> <li>            <span style="color:#2b91af">WordprocessingDocument</span>.Open(args[0], <span style="color:#0000ff">false</span>))</li> <li style="background: #f3f3f3">        {</li> <li>          <span style="color:#2b91af">Console</span>.WriteLine(<span style="color:#a31515">&quot;Found {0} section(s)&quot;</span>,</li> <li style="background: #f3f3f3">              d.MainDocumentPart.Document.Body.Descendants().</li> <li>              OfType&lt;<span style="color:#2b91af">SectionProperties</span>&gt;().Count()</li> <li style="background: #f3f3f3">              );</li> <li>        }</li> <li style="background: #f3f3f3">        <span style="color:#2b91af">Console</span>.WriteLine(<span style="color:#a31515">&quot;Press any key ...&quot;</span>);</li> <li>        <span style="color:#2b91af">Console</span>.ReadKey();</li> <li style="background: #f3f3f3">      }</li> <li>    }</li> <li style="background: #f3f3f3">  }</li> <li>}</li> </ol> </div> </div> </div>  <p>In it I take the filename passed as an argument and open it ReadOnly (line 22-23). I then find the number of sections using the typed enumerator (lines 26-27)</p>  <p>I also added the path to a file in the Command Line Arguments edit box in the Debug tab of the project Properties so there's a file being passed in when I press F5:</p>  <p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Pass a file name in as a command line argument" border="0" alt="Pass a file name in as a command line argument" src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/39/01/metablogapi/3252.image_4B699C28.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-01-metablogapi/3252.image_5F00_4B699C28.png" width="648" height="555" /></p>  <p>Running the program gives the answer very quickly:</p>  <p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Resulting output - we found 2 sections" border="0" alt="Resulting output - we found 2 sections" src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/39/01/metablogapi/8154.image_73E9F7BC.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-01-metablogapi/8154.image_5F00_73E9F7BC.png" width="681" height="346" /></p>  <p>Cool huh?</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:03d96f02-351f-418a-910d-e80417df3353" class="wlWriterEditableSmartContent"><p>Sample file with 2 sections <a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/39/01/metablogapi/3252.Doc-with-2-sections_16A341F4.docx" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-01-metablogapi/3252.Doc_2D00_with_2D00_2_2D00_sections_5F00_16A341F4.docx" target="_blank">Download</a></p></div></div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
