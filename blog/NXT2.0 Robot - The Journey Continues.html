<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>NXT2.0 Robot - The Journey Continues</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/Andrew Coates [MSFT]' target='_blank'>Andrew Coates [MSFT]</a>
<time>    1/25/2010 4:15:18 AM</time>
<hr>
<div id='content'><p>In my <a href="http://blogs.msdn.com/acoat/archive/2010/01/13/lego-mindstorms-nxt2-0-trophybot.aspx">previous post</a>, I talked about getting a new Lego Mindstorms NXT 2.0 robotics kit and about building TrophyBot to carry around a Lego trophy <a href="http://blogs.msdn.com/ceibner">Catherine Eibner</a> won for being an <a href="http://blogs.msdn.com/ceibner/archive/2010/01/07/today-mylife-complete.aspx">awesome evangelist</a>. In this post, as promised, I'll talk about how I programmed the robot to move around, shouting &quot;HORRAY!&quot; whenever it bumped into anything.</p>  <p>The Lego Mindstorms NXT software is a really nice piece of work. It's a Flash player preloaded with the always excellent step-by-step instructions for building four very cool robots, a vehicle (<a href="http://media1.firebox.com/pic/p2480_extra2a.jpg" target="_blank">ShooterBot</a>), an animal (<a href="http://media1.firebox.com/pic/p2480_extra2c.jpg" target="_blank">Robogator</a>), a machine (<a href="http://ro-botica.com/img/NXT/2.0color.jpg" target="_blank">Color Sorter</a>) and a humanoid (<a href="http://media1.firebox.com/pic/p2480_extra2b.jpg" target="_blank">Alpha Rex</a>). Lego instructions are exceptionally thorough, which means that even a novice can construct a working robot in fairly short order.</p>  <p><img title="Step-by-step instructions" alt="Step-by-step instrcutions" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/LegoMindstormsNXT2.0TrophyBot_127FB/instructions_1.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/LegoMindstormsNXT2.0TrophyBot_127FB/instructions_1.png" /></p>  <blockquote>   <p><strong>Aside</strong>: I've been thinking a bit about the corollary between these step-by-step logo instructions and how I started programming, which was copying 100 or so lines of code out of a magazine to do &lt;insert inane or mundane thing here&gt;. Having something to copy meant that I had a base to experiment from, to draw conclusions about and to formulate patterns around. I could generalise and improvise. This fed my curiosity far more than I see my childrens' being fed by the current &quot;download 1000 lines and a couple of libraries from the internet&quot;. I think that actually typing in the code and fixing the inevitable typos gave me more insight. I've noticed this trait in my kids though when they build Lego. The instructions are very clear, but they have to execute every one of them to make the robot (or what ever they're building) work. They're much more familiar with it than if I'd built it for them and said &quot;have a look at this and see how it works&quot;. My gut feel (completely devoid of any science) is that their curiosity is awakened by the feeling of ownership and achievement that comes with building it themselves.</p> </blockquote>  <p>I used the first section of Shooterbot - the driving base - for Trophybot</p>  <p><a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_2.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_2.png" target="_blank"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Shooterbot Driving Base" border="0" alt="Shooterbot Driving Base" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_thumb.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_thumb.png" width="589" height="484" /></a> </p>  <p>To this I needed to add a bump sensor (so Trophybot could detect and move away from obstacles) and a platform to hold the trophy.</p>  <p>&#160;</p>  <p><a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03039.jpg" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03039.jpg" target="_blank"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Trophybot platform" border="0" alt="Trophybot platform" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03039_thumb.jpg" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03039_thumb.jpg" width="244" height="184" /></a> <a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03040_1.jpg" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03040_1.jpg" target="_blank"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Trophybot bump sensor" border="0" alt="Trophybot bump sensor" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03040_thumb_1.jpg" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/DSC03040_thumb_1.jpg" width="184" height="244" /></a>&#160; </p>  <p>Ignore the ultrasonic sensor (that looks like a pair of eyes), it's not used at this stage.</p>  <p>The next step was to actually make Trophybot do something. First, I had to connect the NXT to the computer. There are a couple of ways to do this, either tether via USB or connect via Bluetooth. the instructions for both are pretty straightforward, so I did both.</p>  <p>Now it was time to write the first bit of code. In fact, using the NXT software, it's actually a matter of assembling and wiring together programming blocks. Initially, I just wanted Trophybot to go forwards and I'd manually pick it up and turn it off.</p>  <p>I created a new program called, originally enough, &quot;Go Forward&quot; and was presented with a blank canvas:</p>  <p><a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_4.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_4.png" target="_blank"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Starting a new mindstorms program" border="0" alt="Starting a new mindstorms program" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_thumb_1.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_thumb_1.png" width="391" height="484" /></a> </p>  <p></p>  <p>I grabbed the Move block from the top of the toolbar and dropped it where it says &quot;Start&quot;. When the new block's selected, a properties pane appears at the bottom of the screen to let you set properties for that block. I set the duration property to Unlimited and hit the download button.</p>  <p><a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_6.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_6.png" target="_blank"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Go forward - first draft" border="0" alt="Go forward - first draft" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_thumb_2.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_thumb_2.png" width="420" height="484" /></a> </p>  <p>I pressed the orange button on the NXT brick 4 times to run the program I'd just downloaded and nothing happened - hmm.</p>  <p>OK - maybe the environment's smart enough not to get into an infinite loop, so I added some logic - what I thought might be a sensible way to represent an event (in this case, the sensor getting pressed). I chose the complete palette in the blocks toolbox and dropped a touch sensor on the canvas. I didn't connect it to anything because I figured this would be an event that happened and broke into whatever was going on at the time.</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Sensor event?" border="0" alt="Sensor event?" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_9.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_9.png" width="208" height="232" /> </p>  <p>The sensor block stayed greyed-out, which I guessed meant that it wouldn't be used. More work needed.</p>  <p>Next I tried putting all the logic in a loop that polled the state of the sensor each iteration and then took the appropriate action.</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Move and check in a loop" border="0" alt="Move and check in a loop" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_12.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/image_12.png" width="495" height="274" /> </p>  <p>This says:</p>  <pre class="code">Loop
  If sensor not pressed or bumped 
    Go forward 1 second
  Else
    Go back 1 revolution
    Turn right 1 revolution
  EndIf
End Loop</pre>

<p>Which at least made the robot move but it had two drawbacks:</p>

<ol>
  <li>It moved forward in 1 second jerks followed by a small break; and</li>

  <li>It didn't react to a bump or press until the second of forward motion was done.</li>
</ol>

<p>Interestingly, the way to fix this is to make the motion in the top part of the loop unlimited instead of making it a specific duration. The unlimited move block is a special case that actually means keep moving until the condition at the start of the loop changes. It also doesn't work outside a loop (which is why my first, single block, program failed) because it &quot;falls through immediately to the next step.</p>

<p>Finally, I added some randomness to the program that meant that the robot turns in a random direction and a random number of degrees when it hits something. This seems to give it more of a chance to get out of corners and away from complex obstacles. I also added a play sound block to make the bot say &quot;Horray!&quot; whenever it bumped into something.</p>

<p>The final program looks like this:</p>

<p><a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/TrophyBotd_4.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/TrophyBotd_4.png" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="TrophyBot final program" border="0" alt="TrophyBot final program" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/TrophyBotd_thumb_1.png" original-url="http://blogs.msdn.com/blogfiles/acoat/WindowsLiveWriter/NXT2.0RobotTheJourneyContinues_12D0E/TrophyBotd_thumb_1.png" width="644" height="445" /></a> </p>

<p>All-in-all, this was a really fun start to what's going to be a much longer term project. I've managed to acquire a Lego Technics truck that is ripe for roboticising and I'm looking forward to having a play with the .NET programming environment provided by Microsoft Robotics Studio.</p>

<p>I'll keep you in the (infinite) loop.</p>

<p>All-in-all</p></div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
